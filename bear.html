<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polar Bear's Marshmallow Challenge</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Fredoka One', cursive; 
            background: linear-gradient(to bottom, #2c5364, #203a43, #0f2027);
            color: #2c3e50; text-align: center; padding: 20px; overflow-x: hidden; min-height: 100vh;
            margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        /* Snowflake layer */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .snowflake { color: #fff; font-size: 1.2rem; position: absolute; top: -10%; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* Unique Container */
        .game-wrapper { 
            position: relative; z-index: 10;
            background: rgba(255, 255, 255, 0.95); border-radius: 40px; padding: 30px; 
            max-width: 800px; width: 90%; border: 8px solid #3498db; 
            box-shadow: 0 15px 0 #2980b9; margin: 20px;
        }

        #bear-img { width: 160px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1)); }
        .mission-text { color: #2980b9; font-size: 1.1rem; margin-bottom: 10px; }

        .reward-zone { 
            background: #fff3e0; padding: 15px; border-radius: 20px; 
            margin: 15px 0; border: 3px dashed #ff9800; display: flex; 
            justify-content: center; gap: 12px;
        }
        .marshmallow { 
            font-size: 2.2rem; filter: grayscale(100%); opacity: 0.2; 
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .marshmallow.earned { filter: grayscale(0%); opacity: 1; transform: scale(1.3) rotate(360deg); }

        .scenario-box { 
            background: #f0f7ff; padding: 20px; border-radius: 20px; 
            margin: 15px 0; font-size: 1.3rem; border-left: 10px solid #3498db;
            color: #34495e; min-height: 60px;
        }
        
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .choice-btn {
            padding: 18px; border-radius: 20px; border: 3px solid #3498db;
            background: #fff; color: #2c3e50; cursor: pointer;
            font-size: 1rem; font-weight: bold; transition: 0.3s;
            box-shadow: 0 6px #3498db; display: flex; align-items: center; justify-content: center;
        }
        .choice-btn:hover { background: #e1f5fe; transform: scale(1.03); }
        .choice-btn:active { transform: translateY(4px); box-shadow: none; }

        .back-btn { color: white; text-decoration: none; border-bottom: 2px solid white; z-index: 10; margin-top: 10px; }
    </style>
</head>
<body>

<div id="snow-container"></div>

<div class="game-wrapper animate__animated animate__zoomIn">
    <img src="polar_bear.jpg" id="bear-img" class="animate__animated animate__pulse animate__infinite" alt="Polar Bear">
    <h1 style="color: #2980b9; margin: 10px 0;">The Marshmallow Challenge</h1>
    <p class="mission-text">Help Polar Bear keep calm for his <strong>calming cocoa!</strong></p>

    <div class="reward-zone">
        <span id="m1" class="marshmallow">‚òÅÔ∏è</span>
        <span id="m2" class="marshmallow">‚òÅÔ∏è</span>
        <span id="m3" class="marshmallow">‚òÅÔ∏è</span>
    </div>

    <div class="scenario-box" id="scenario-text">Loading...</div>
    <div class="choice-grid" id="choices"></div>
</div>

<a href="index.html" class="back-btn">‚¨Ö Back to Map</a>

<script>
    let currentStep = 0;
    let earnedCount = 0;

    function createSnow() {
        const container = document.getElementById('snow-container');
        for (let i = 0; i < 25; i++) {
            let snow = document.createElement('div');
            snow.className = 'snowflake';
            snow.innerHTML = '‚ùÑ';
            snow.style.left = Math.random() * 100 + 'vw';
            snow.style.animationDuration = (Math.random() * 3 + 2) + 's';
            snow.style.opacity = Math.random();
            container.appendChild(snow);
        }
    }

    const gameData = [
        {
            scenario: "The other bears are playing tag, but they forgot to ask Polar Bear. He feels 'Invisible'.",
            options: [
                { text: "Walk up and say: 'Hey, can I be IT next round?'", type: "wise", feedback: "Brave move! They said yes immediately." },
                { text: "Sit behind a rock and wait for them to notice.", type: "impulse", feedback: "They're busy playing; they might not see you. You're just cold now." },
                { text: "Do a big stretch and remember: 'I am fun to play with.'", type: "wise", feedback: "Self-talk is a superpower. You felt better and joined in!" },
                { text: "Think: 'They are mean and I hate this game.'", type: "impulse", feedback: "That 'Spiky Thought' makes you feel worse, not better." }
            ]
        },
        {
            scenario: "Polar Bear's favorite ice-fishing hole is frozen shut! He's hungry and 'angry heat' is rising.",
            options: [
                { text: "Take 5 slow breaths and look for a new hole.", type: "wise", feedback: "Smart! Calm eyes find fish faster." },
                { text: "Stomp on the ice until your feet hurt.", type: "impulse", feedback: "Now your feet hurt AND you're still hungry." },
                { text: "Ask a friend to help chip the ice away.", type: "wise", feedback: "Teamwork! You both got to eat lunch." },
                { text: "Yell 'THIS IS UNFAIR' at the sky.", type: "impulse", feedback: "The sky didn't answer, and now you have a sore throat." }
            ]
        }
    ];

    function loadGame() {
        if (currentStep >= gameData.length) {
            Swal.fire({
                title: "VICTORY COCOA! ‚òï",
                text: "You helped Polar Bear stay in his Wise Mind!",
                imageUrl: 'polar_bear_gif/polar_bear_hot_choc.gif', 
                imageWidth: 400,
                confirmButtonText: "Return to Map",
                confirmButtonColor: "#ff9800"
            }).then(() => window.location.href = "index.html");
            return;
        }

        const data = gameData[currentStep];
        document.getElementById('scenario-text').innerHTML = data.scenario;
        const choiceContainer = document.getElementById('choices');
        choiceContainer.innerHTML = "";

        data.options.sort(() => Math.random() - 0.5).forEach(opt => {
            const btn = document.createElement('button');
            btn.className = `choice-btn animate__animated animate__fadeInUp`;
            btn.innerHTML = opt.text;
            btn.onclick = () => {
                if (opt.type === "wise") {
                    earnedCount++;
                    document.getElementById(`m${earnedCount}`).classList.add('earned');
                    Swal.fire({ title: "Marshmallow Earned! ‚òÅÔ∏è", text: opt.feedback, icon: "success" }).then(() => {
                        currentStep++;
                        loadGame();
                    });
                } else {
                    Swal.fire({ title: "Impulse Trap! ü™§", text: opt.feedback, icon: "error" });
                }
            };
            choiceContainer.appendChild(btn);
        });
    }

    createSnow();
    loadGame();
</script>
</body>
</html>
